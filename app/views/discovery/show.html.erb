<html>
<%= stylesheet_link_tag 'discovery' %>
<div class="container">
  <div class="jumbotron">
    <div class="header-button home-button">
      <i onclick="" class="fa fa-3x fa-home" aria-hidden="true"></i>
    </div>
    <div class="header-button user">
      <i class="fa fa-3x fa-user" aria-hidden="true"></i>
    </div>
    <div class="text-center">
      <h1 class="animated bounce">Discover</h1>
      <h3>New Music. Unheard Talent.</h3>
    </div>
  </div>
  <div class="center" id="song_info">
    <div class="animated slideInRight discovery_main">
      <div class="music-display">
        <div class="image-wrapper">
          <img id="song_art" src=<%= @img %> >
          <progress class="progressbar" id="progressbar" value="0" max="100"> </progress>
        </div>
      </div>

      <div class="controls">
        <h1 id="song_title"><%= @song.title %></h1>
        <h3 id="song_artist"><%= @song.artist %></h3>
      </div>
      <audio id="songMP3" ontimeupdate="updateProgress()" src="<%= @mp3 %>"></audio>
    </div>
  </div>
  <footer class="container-fluid soundOffFooter">
    <div class="text-center">
      <p>All Rights Reserved - Copyright SoundOff Inc. &copy; 2017 </p>
    </div>
  </footer>
</div>
</html>
<script>
  var playing = true;


  $(document).ready(function(){
      window.addEventListener('keydown', myEventHandler, false);
  });


  function myEventHandler(e){
    var keyCode = e.keyCode;
    if(keyCode == 39) {
      $.ajax({
          url: "/discovery/next",
          type: 'POST',
          dataType: 'script'
      });
    }
    else if (keyCode == 38) {

    }
    else if (keyCode == 32){
        if (playing) {
            document.getElementById('songMP3').play();
        } else {
            document.getElementById('songMP3').pause();
        }
        playing = !playing
    }
  }
  function updateProgress() {
      var value = 0;
      var audio = document.getElementById('songMP3');
      if (audio.currentTime > 0) {
          value = Math.floor((100 / audio.duration) * audio.currentTime);
      }
      document.getElementById("progressbar").value = value
  }

</script>